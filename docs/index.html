<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta id="repository-name" content="github.com/drujensen/kemalyst">
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="js/doc.js"></script>
  <title>README - github.com/drujensen/kemalyst</title>
</head>
<body>

<div id="types-list">
  <div id="search-box">
    <input type="search" id="search-input" placeholder="Search...">
  </div>

  <ul>
    <li class="current"><a href="index.html">README</a></li>
  </ul>

  <ul>
  
  <li class="parent " data-id="github.com/drujensen/kemalyst/Kemalyst" data-name="kemalyst">
      <a href="Kemalyst.html">Kemalyst</a>
      
        <ul>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Application" data-name="kemalyst::application">
      <a href="Kemalyst/Application.html">Application</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Controller" data-name="kemalyst::controller">
      <a href="Kemalyst/Controller.html">Controller</a>
      
    </li>
  
  <li class="parent " data-id="github.com/drujensen/kemalyst/Kemalyst/Exceptions" data-name="kemalyst::exceptions">
      <a href="Kemalyst/Exceptions.html">Exceptions</a>
      
        <ul>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Exceptions/Forbidden" data-name="kemalyst::exceptions::forbidden">
      <a href="Kemalyst/Exceptions/Forbidden.html">Forbidden</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Exceptions/RouteNotFound" data-name="kemalyst::exceptions::routenotfound">
      <a href="Kemalyst/Exceptions/RouteNotFound.html">RouteNotFound</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler" data-name="kemalyst::handler">
      <a href="Kemalyst/Handler.html">Handler</a>
      
        <ul>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Base" data-name="kemalyst::handler::base">
      <a href="Kemalyst/Handler/Base.html">Base</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/BasicAuth" data-name="kemalyst::handler::basicauth">
      <a href="Kemalyst/Handler/BasicAuth.html">BasicAuth</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Block" data-name="kemalyst::handler::block">
      <a href="Kemalyst/Handler/Block.html">Block</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/CORS" data-name="kemalyst::handler::cors">
      <a href="Kemalyst/Handler/CORS.html">CORS</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/CSRF" data-name="kemalyst::handler::csrf">
      <a href="Kemalyst/Handler/CSRF.html">CSRF</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Error" data-name="kemalyst::handler::error">
      <a href="Kemalyst/Handler/Error.html">Error</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Flash" data-name="kemalyst::handler::flash">
      <a href="Kemalyst/Handler/Flash.html">Flash</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Logger" data-name="kemalyst::handler::logger">
      <a href="Kemalyst/Handler/Logger.html">Logger</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Params" data-name="kemalyst::handler::params">
      <a href="Kemalyst/Handler/Params.html">Params</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Route" data-name="kemalyst::handler::route">
      <a href="Kemalyst/Handler/Route.html">Route</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Router" data-name="kemalyst::handler::router">
      <a href="Kemalyst/Handler/Router.html">Router</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Session" data-name="kemalyst::handler::session">
      <a href="Kemalyst/Handler/Session.html">Session</a>
      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/Handler/Static" data-name="kemalyst::handler::static">
      <a href="Kemalyst/Handler/Static.html">Static</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/drujensen/kemalyst/Kemalyst/WebSocket" data-name="kemalyst::websocket">
      <a href="Kemalyst/WebSocket.html">WebSocket</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

</div>

<div id="main-content">
<p><a href="https://travis-ci.org/drujensen/kemalyst" target="_blank"><img src="https://travis-ci.org/drujensen/kemalyst.svg?branch=master" alt="Build Status"/></a></p>

<p><a href="http://drujensen.github.io/kemalyst/" target="_blank">Documentation</a></p>

<h1>Kemalyst</h1>

<p>Kemalyst is a yarlf (yet another rails like framework) that is based on on
super fast <a href="https://github.com/sdogruyol/kemal" target="_blank">kemal</a>. The framework
leverages the http handlers which are similar to Rack middleware.</p>

<p>The router and controllers are an extension of the same middleware so you can
chain any compatible HTTP::Handler before or after the routing handler so you
can limit a particular handler to a sub-tree of your routes.</p>

<p>The model is a simple ORM mapping and supports MySQL, PG and SQLite.</p>

<p>The views are handled using <a href="https://github.com/jeromegn/kilt" target="_blank">kilt</a> and several macros to simplify
development.</p>

<h2>Installation</h2>

<ol><li>Install Crystal</li></ol>

<p>You can find instructions on how to install Crystal from <a href="http://crystal-lang.org" target="_blank">Crystal's
Website</a>.  I recommend using
<a href="https://github.com/pine613/crenv" target="_blank">crenv</a> to manage your crystal versions.</p>

<ol><li>Create a Crystal App</li></ol>

<pre><code class='language-crystal init app [your_app]
cd [your_app]'>```
3. Add kemalyst dependency to your shard.yml</code></pre>

<p>dependencies:
  kemalyst:</p>

<pre><code>github: drujensen<span class="s">/kemalyst</code></pre>

<p># optional</p>

<p># postgres driver is still in development
  pg:</p>

<pre><code>github: asterite<span class="s">/crystal-pg
branch: feature/</span>db</code></pre>

<p># when it is released
  pg:</p>

<pre><code>github: crystal<span class="o">-</span>lang<span class="s">/crystal-pg</code></pre>

<p>mysql:</p>

<pre><code>github: crystal<span class="o">-</span>lang<span class="s">/crystal-mysql</code></pre>

<p>sqlite3:</p>

<pre><code>github: crystal<span class="o">-</span>lang<span class="s">/crystal-sqlite3</code></pre>

<pre><code>and run <span class="s">&#96;crystal deps&#96;</span>.

<span class="c">### Post Install</span>

<span class="t">To</span> keep a similar structure to yarlf, several directories and files will be
installed.  <span class="t">This</span> structure should look familiar to you <span class="k">if</span> your coming from a
<span class="t">Rails</span> background.
 <span class="o">-</span> <span class="s">/client - npm, webpack, and jasmine to support es6 and sass.  &#96;npm run build&#96;,
   &#96;npm run test&#96;, and &#96;npm run lint&#96;.
 - /</span>config <span class="o">-</span> <span class="t">Application</span> and <span class="t">HTTP</span><span class="t">::</span><span class="t">Handler</span> config</code></pre>

<p>rm src/[your_app].cr
rm -r src/[your_app]
rm spec/[your_app]_spec.cr
rm spec/spec_helper.cr_old</p>

<pre><code>
<span class="c">## Usage</span>

<span class="c">### Run Locally</span>
<span class="t">To</span> test the demo app locally:

<span class="n">1</span>. create a postgres database called <span class="s">&#96;&#91;your_app&#93;&#96;</span>
<span class="n">2</span>. run <span class="s">&#96;export DATABASE_URL&#61;postgres://&#91;username&#93;:&#91;password&#93;&#64;localhost:5432/&#91;your_app&#93;&#96;</span>
<span class="n">3</span>. migrate the database: <span class="s">&#96;crystal db/migrate.cr&#96;</span>
<span class="n">4</span>. run the specs: <span class="s">&#96;crystal spec&#96;</span>

<span class="t">To</span> build the demo app locally:

<span class="n">1</span>. build the app <span class="s">&#96;crystal build --release src/app.cr&#96;</span>
<span class="n">2</span>. run <span class="k">with</span> <span class="s">&#96;./app&#96;</span>
<span class="n">3</span>. visit <span class="s">&#96;http://0.0.0.0:3000/&#96;</span>

<span class="c">### Run Sentry</span>
[<span class="t">Sentry</span>](https<span class="n">:/</span><span class="s">/github.com/</span>samueleaton<span class="s">/sentry&#41; is included in the &#96;/</span>dev</code></pre>

<p>docker-compose build
docker-compose up -d
docker-compose logs -f</p>

<pre><code><span class="t">This</span> will download an ubuntu<span class="s">/cedar image compatible with heroku and has all the
dependencies including a postgres database.

Now you should be able to hit the site:</code></pre>

<p>open "http://localhost"</p>

<pre><code>
<span class="t">Docker</span> <span class="t">Compose</span> is running [<span class="t">Sentry</span>](https<span class="n">:/</span><span class="s">/github.com/</span>samueleaton<span class="s">/sentry&#41; so
any changes to your &#96;/</span>src<span class="s">&#96; or &#96;</span><span class="s">/config&#96; will re-build and run your
application.

### Cookie Session
You will need to set a secret for the session.  Run the following
command:</code></pre>

<p>crystal eval "require \"secure_random\"; puts SecureRandom.hex(64)"</p>

<pre><code>copy the secret and set this <span class="k">in</span> <span class="s">&#96;config/session.cr&#96;</span>.

<span class="c">### Sample Applications</span>

<span class="t">Several</span> sample applications are provided:

 <span class="o">-</span> [<span class="t">Blog</span> <span class="t">Kemalyst</span>](https<span class="n">:/</span><span class="s">/github.com/</span>drujensen<span class="s">/blog-kemalyst&#41;
 - &#91;Chat Kemalyst&#93;&#40;https:/</span><span class="s">/github.com/</span>drujensen<span class="s">/chat-kemalyst&#41;
 - &#91;ToDo Backend Kemalyst&#93;&#40;https:/</span><span class="s">/github.com/</span>drujensen<span class="s">/todo-backend-kemalyst&#41;

### Configure App

All config settings are in the &#96;/</span>config<span class="s">&#96; folder.  Each handler has its own
settings.  You will find the &#96;</span>database.yml<span class="s">&#96; and &#96;</span>routes.cr<span class="s">&#96; here. Checkout
the samples that demonstrates a traditional blog site and a websocket chat
app.

### Middleware HTTP::Handlers

There are 7 handlers that are pre-configured for Kemalyst:
 - Logger - Logs all requests/responses to the logger configured.
 - Error - Handles any Exceptions and renders a response.
 - Static - Delivers any static assets from the &#96;</span>.<span class="s">/public&#96; folder.
 - Session - Provides a Cookie Session hash that can be accessed from the &#96;context.session&#91;&quot;key&quot;&#93;&#96;
 - Flash - Provides flash message hash that can be accessed from the &#96;context.flash&#91;&quot;danger&quot;&#93;&#96;
 - Params - Unifies the parameters into &#96;context.params&#91;&quot;key&quot;&#93;&#96;
 - Router - Routes requests to other handlers based on the method and path.

Other handlers available for Kemalyst:
 - BasicAuth - Provides Basic Authentication.
 - CORS - Handles Cross Origin Resource Sharing.
 - CSRF - Helps prevent Cross Site Request Forgery.

You may want to add, replace or remove handlers based on your situation.  You can do that in the
Application configuration &#96;config/</span>application.cr<span class="s">&#96;:
</code></pre>

<p>Kemalyst::Application.config do |config|
  # handlers will be chained in the order provided
  config.handlers = [</p>

<pre><code><span class="t">Kemalyst</span><span class="t">::</span><span class="t">Handler</span><span class="t">::</span><span class="t">Logger</span>.instance,
<span class="t">Kemalyst</span><span class="t">::</span><span class="t">Handler</span><span class="t">::</span><span class="t">Error</span>.instance,
<span class="t">Kemalyst</span><span class="t">::</span><span class="t">Handler</span><span class="t">::</span><span class="t">Params</span>.instance,
<span class="t">Kemalyst</span><span class="t">::</span><span class="t">Handler</span><span class="t">::</span><span class="t">CORS</span>.instance,
<span class="t">Kemalyst</span><span class="t">::</span><span class="t">Handler</span><span class="t">::</span><span class="t">Router</span>.instance</code></pre>

<p>]
end</p>

<pre><code>
<span class="c">### Router</span>

<span class="t">The</span> router will perform a lookup based on the method and path and <span class="k">return</span> the
chain <span class="k">of</span> handlers you specify <span class="k">in</span> the <span class="s">&#96;/config/routes.cr&#96;</span> file.

<span class="t">An</span> example <span class="k">of</span> a route would be:</code></pre>

<p>get "/",   DemoController::Index</p>

<pre><code>
<span class="t">You</span> may chain multiple handlers <span class="k">in</span> a route using an array:</code></pre>

<p>get "/", [ BasicAuth.instance("username", "password"),</p>

<pre><code>       <span class="t">DemoController</span><span class="t">::</span><span class="t">Index</span>.instance ]</code></pre>

<pre><code>or add them individually <span class="k">in</span> the correct order:</code></pre>

<p>get "/", BasicAuth.instance("username", "password")
get "/", DemoController::Index.instance</p>

<pre><code>
<span class="t">This</span> is how you would configure a <span class="t">WebSocket</span> <span class="t">Controller</span>:</code></pre>

<p>get "/", ChatController::Chat
get "/", ChatController::Index</p>

<pre><code>
<span class="t">See</span> below <span class="k">for</span> more information on how to create a <span class="t">WebSocket</span> <span class="t">Handler</span>.

<span class="t">You</span> can use any <span class="k">of</span> the following methods: <span class="s">&#96;get, post, put, patch, delete, all&#96;</span>

<span class="t">You</span> can use a <span class="s">&#96;*&#96;</span> to chain a handler <span class="k">for</span> all children <span class="k">of</span> this path:</code></pre>

<p>all    "/posts/*",   BasicAuth.instance("admin", "password")</p>

<h1>all of these will be secured with the BasicAuth handler.</h1>

<p>get    "/posts/:id", DemoController::Show
put    "/posts/:id", DemoController::Update
delete "/posts/:id", DemoController::Delete</p>

<pre><code>
<span class="t">You</span> can enable <span class="t">CSRF</span> protection <span class="k">for</span> all <span class="s">&#96;post&#96;</span> and <span class="s">&#96;put&#96;</span> calls:</code></pre>

<p>post "/<em>",   CSRF
put  "/</em>",   CSRF</p>

<pre><code>
<span class="t">Then</span> <span class="k">in</span> your forms, add the <span class="s">&#96;csrf_tag&#96;</span> using the helper method:</code></pre>

<p>&lt;form action="/demos/&lt;%= demo.id %>" method="post">
  &lt;%= csrf_tag(context) %>
  ...
&lt;/form></p>

<pre><code>
<span class="t">You</span> can use <span class="s">&#96;:variable&#96;</span> <span class="k">in</span> the path and it will set a
context.params[<span class="s">&quot;variable&quot;</span>] to the value <span class="k">in</span> the url.

<span class="c">### Controllers</span>

<span class="t">The</span> <span class="t">Controller</span> inherits from <span class="t">HTTP</span><span class="t">::</span><span class="t">Handler</span> which is the middleware similar to
<span class="t">Rack</span></code></pre>

<p>require "../models/post"</p>

<p>class Index &lt; Kemalyst::Controller
  def call(context)</p>

<pre><code>posts <span class="o">=</span> <span class="t">Post</span>.all(<span class="s">&quot;ORDER BY created_at DESC&quot;</span>)
render <span class="s">&quot;post/index.ecr&quot;</span>, <span class="s">&quot;main.ecr&quot;</span></code></pre>

<p>end
end</p>

<pre><code>
<span class="t">There</span> are several helper macros that set content <span class="k">type</span> and response.</code></pre>

<p>render   "filename.ecr"       # renders an .ecr template
  render   "filename.ecr", "layout.ecr" # renders an .ecr template with layout
  redirect "path"               #redirect to path
  text     "body", 200          #render text/plain with status code of 200
  json     "{}".to_json, 200    #render application/json with status code of 200
  html     "&lt;html>&lt;/html>", 200 #render text/html with status code of 200</p>

<pre><code>
<span class="c">### WebSocket Controllers</span>

<span class="t">The</span> <span class="t">WebSocket</span> <span class="t">Controller</span> will handle upgrading a <span class="t">HTTP</span> <span class="t">Request</span> to a <span class="t">WebSocket</span>
<span class="t">Connection</span>.

<span class="t">An</span> example <span class="t">WebSocket</span> <span class="t">Controller</span>:</code></pre>

<p>class Chat &lt; Kemalyst::WebSocket
  @sockets = [] of HTTP::WebSocket
  @messages = [] of String</p>

<p>def call(socket : HTTP::WebSocket)</p>

<pre><code>@sockets.push socket
socket.on_message <span class="k">do</span> <span class="o">|</span>message<span class="o">|</span>
  @messages.push message
  @sockets.each <span class="k">do</span> <span class="o">|</span>a_socket<span class="o">|</span>
    a_socket.send @messages.to_json
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>end
end</p>

<pre><code><span class="t">The</span> <span class="s">&#96;Chat&#96;</span> <span class="k">class</span> will override the <span class="s">&#96;call&#96;</span> method that is expecting an
<span class="s">&#96;HTTP::WebSocket&#96;</span> to be passed which it would maintain and properly handle
messages to and from each socket.

<span class="t">This</span> <span class="k">class</span> will manage an array <span class="k">of</span> <span class="s">&#96;HTTP::Websocket&#96;</span>s and configures the
<span class="s">&#96;on_message&#96;</span> callback that will manage the messages that will be <span class="k">then</span> be
passed on to all <span class="k">of</span> the other sockets.

<span class="t">It</span></code></pre>

<p>get "/", ChatController::Chat
get "/", ChatController::Index</p>

<pre><code><span class="t">The</span> first one is a <span class="t">WebSocket</span> <span class="t">Controller</span> and the second is a standard
<span class="t">Controller</span>.  <span class="t">If</span> the request is not a <span class="t">WebSocket</span> upgrade request, it will
pass<span class="o">-</span>through and call the second one that will <span class="k">return</span> the html page.


<span class="t">To</span> see a full example application, checkout
[<span class="t">Chat</span> <span class="t">Kemalyst</span>](https<span class="n">:/</span><span class="s">/github.com/</span>drujensen<span class="s">/chat-kemalyst&#41;

### Views

Views are rendered using &#91;Kilt&#93;&#40;http:/</span><span class="s">/github.com/</span>jeromegn<span class="s">/kilt&#41;.  Currently,
there are 4 different templating languages supported by Kilt: &#96;ecr&#96;, &#96;mustache&#96;,
&#96;slang&#96; and &#96;temel&#96;.  Kilt will select the templating engine based on the
extension of the file so &#96;index.ecr&#96; will render the file using the ECR
engine.


The render method is configured to look in the &quot;src/</span>views<span class="s">&quot; path to keep the
controllers simple.  You may also render with a layout which will look for
this in the &quot;</span>src<span class="s">/views/</span>layouts<span class="s">&quot; directory.
</code></pre>

<p>render "post/index.ecr", "main.ecr"</p>

<pre><code><span class="t">This</span> will render the index.ecr template inside the main.ecr layout. <span class="t">All</span> local
variables assigned <span class="k">in</span> the controller are available <span class="k">in</span> the templates.

<span class="t">An</span> example <span class="s">&#96;views/post/index.ecr&#96;</span>:</code></pre>

<p>&lt;% posts.each do |post| %>
  &lt;div></p>

<pre><code><span class="o"><</span>h2<span class="o">></span><span class="o"><</span>%= post.name <span class="o">%</span><span class="o">></span><span class="o"><</span><span class="s">/h2&gt;
&lt;p&gt;&lt;&#37;&#61; post.body &#37;&gt;&lt;/</span>p<span class="o">></span>
<span class="o"><</span>p<span class="o">></span>
  <span class="o"><</span>a href<span class="o">=</span><span class="s">&quot;/posts/&lt;&#37;&#61; post.id &#37;&gt;&quot;</span><span class="o">></span>read<span class="o"><</span><span class="s">/a&gt;
  | &lt;a href&#61;&quot;/</span>posts<span class="s">/&lt;&#37;&#61; post.id &#37;&gt;/</span>edit<span class="s">&quot;&gt;edit&lt;/a&gt; |
  &lt;a href&#61;&quot;</span><span class="s">/posts/</span><span class="o"><</span>%= post.id <span class="o">%</span><span class="o">></span>?_method<span class="o">=</span>delete<span class="s">&quot; onclick&#61;&quot;</span><span class="k">return</span> confirm(</code></pre>

<p>&lt;/div>
&lt;% end %></p>

<pre><code>
<span class="t">And</span> an example <span class="k">of</span> <span class="s">&#96;views/layouts/main.ecr&#96;</span>:</code></pre>

<p>&lt;!DOCTYPE html>
&lt;html>
  &lt;head></p>

<pre><code><span class="o"><</span>title<span class="o">></span><span class="t">Example</span> <span class="t">Layout</span><span class="o"><</span><span class="s">/title&gt;
&lt;link rel&#61;&quot;stylesheet&quot; href&#61;&quot;/</span>stylesheets<span class="s">/main.css&quot;&gt;</code></pre>

<p>&lt;/head>
  &lt;body></p>

<pre><code><span class="o"><</span>div <span class="k">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="o">></span>

  <span class="o"><</span>div <span class="k">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="o">></span>
  <span class="o"><</span><span class="o">%</span> context.flash.each <span class="k">do</span> <span class="o">|</span>key, value<span class="o">|</span> <span class="o">%</span><span class="o">></span>
    <span class="o"><</span>div <span class="k">class</span><span class="o">=</span><span class="s">&quot;alert alert-&lt;&#37;&#61; key &#37;&gt;&quot;</span><span class="o">></span>
      <span class="o"><</span>p<span class="o">></span><span class="o"><</span>%= value <span class="o">%</span><span class="o">></span><span class="o"><</span><span class="s">/p&gt;
    &lt;/</span>div<span class="o">></span>
  <span class="o"><</span><span class="o">%</span> <span class="k">end</span> <span class="o">%</span><span class="o">></span>
  <span class="o"><</span><span class="s">/div&gt;

  &lt;div class&#61;&quot;row&quot;&gt;
    &lt;div class&#61;&quot;col-sm-12&quot;&gt;
      &lt;&#37;&#61; content &#37;&gt;
    &lt;/</span>div<span class="o">></span>
  <span class="o"><</span><span class="s">/div&gt;

&lt;/</span>div<span class="o">></span></code></pre>

<p>&lt;/body>
&lt;/html></p>

<pre><code><span class="t">The</span> <span class="s">&#96;&lt;&#37;&#61; content &#37;&gt;&#96;</span> is where the template will be rendered <span class="k">in</span> the layout.

<span class="c">### Models</span>

<span class="t">The</span> models are a simple <span class="t">ORM</span> mechanism that will map objects to rows <span class="k">in</span> the
database. <span class="t">There</span> is no dependency on using this model.  <span class="t">I</span> recommend looking at
[<span class="t">Active</span> <span class="t">Record</span>.cr](https<span class="n">:/</span><span class="s">/github.com/</span>waterlink<span class="s">/active_record.cr&#41; by waterlink
as an alternative to this simplistic approach.

The mapping is done using a &#96;sql_mapping&#96; macro.

An example &#96;models/</span>post.cr<span class="s">&#96;</code></pre>

<p>require "kemalyst-model/adapter/pg"</p>

<p>class Post &lt; Kemalyst::Model
  adapter pg</p>

<p>sql_mapping({</p>

<pre><code>name: [<span class="s">&quot;VARCHAR&#40;255&#41;&quot;</span>, <span class="t">String</span>],
body: [<span class="s">&quot;TEXT&quot;</span>, <span class="t">String</span>]</code></pre>

<p>})</p>

<p>end</p>

<pre><code><span class="t">The</span> mapping will automatically create the id, created_at and updated_at column
mapping that follows the active_record convention <span class="k">in</span> <span class="t">Rails</span>.

<span class="t">There</span> are several methods that are provided <span class="k">in</span> the model.
<span class="o">-</span> <span class="k">self</span>.drop <span class="o">-</span> <span class="t">DROP</span> table...
<span class="o">-</span> <span class="k">self</span>.create <span class="o">-</span> <span class="t">CREATE</span> table...
<span class="o">-</span> <span class="k">self</span>.clear <span class="o">-</span> <span class="t">DELETE</span> from table
<span class="o">-</span> <span class="k">self</span>.migrate <span class="o">=</span> <span class="t">Add</span><span class="s">/Update columns to match model definition
- self.prune - Remove any undefined fields from the database
- save - Insert or Update depending on if ID is set
- destroy - DELETE FROM table WHERE id &#61; this.id
- all&#40;where&#41; SELECT * FROM table </span><span class="i">#{</span></span><span class="t">WHERE</span> clause<span class="s"><span class="i">}</span>;&quot;
- find&#40;id&#41; - SELECT * FROM table WHERE id &#61; this.id LIMIT 1;&quot;

You can find more details at &#91;Kemalyst Model&#93;&#40;https:/</span><span class="s">/github.com/</span>drujensen<span class="s">/kemalyst-model&#41;

### Validation

Another Library included with Kemalyst is validation of your models.
You can find more details at &#91;Kemalyst Validators&#93;&#40;https:/</span><span class="s">/github.com/</span>drujensen<span class="s">/kemalyst-validators&#41;

## Contributing

1. Fork it &#40; https:/</span><span class="s">/github.com/</span>drujensen<span class="s">/kemalyst/</span>fork )
<span class="n">2</span>. <span class="t">Create</span> your feature branch (git checkout <span class="o">-</span>b my<span class="o">-</span><span class="k">new</span><span class="o">-</span>feature)
<span class="n">3</span>. <span class="t">Commit</span> your changes (git commit <span class="o">-</span>am </code></pre>
</div>
</body>
</html>
